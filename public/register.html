<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register - Online Banking</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Navigation -->
  <nav>
    <a href="index.html">Home</a>
    <a href="login.html">Login</a>
    <a href="register.html">Register</a>
  </nav>

  <!-- Registration Section -->
  <main>
    <section class="form-container">
      <h2>Create Your Account</h2>
      <form id="registerForm">
        <label for="name">Full Name</label>
        <input type="text" id="name" placeholder="Full Name" required />

        <label for="email">Email Address</label>
        <input type="email" id="email" placeholder="Email Address" required />

        <label for="password">Password</label>
        <div class="password-container">
          <input type="password" id="password" placeholder="Password" required />
          <button type="button" id="togglePassword">üëÅÔ∏è</button>
        </div>
        <div id="passwordCriteria" class="password-criteria">
          <h4>Password Requirements:</h4>
          <ul>
            <li id="lengthCheck">‚ùå At least 8 characters</li>
            <li id="lowercaseCheck">‚ùå At least one lowercase letter (a-z)</li>
            <li id="uppercaseCheck">‚ùå At least one uppercase letter (A-Z)</li>
            <li id="numberCheck">‚ùå At least one number (0-9)</li>
            <li id="specialCheck">‚ùå At least one special character (@$!%*?&)</li>
          </ul>
        </div>
        <p id="passwordStrength" class="info"></p>

        <button type="submit">Register</button>
      </form>
      <p id="error" class="error"></p>
    </section>
  </main>

  <!-- JS Logic -->
  <script>
    // Password visibility toggle
    document.getElementById('togglePassword')?.addEventListener('click', function () {
      const passwordField = document.getElementById('password');
      const toggleButton = document.getElementById('togglePassword');
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleButton.textContent = 'üôà';
      } else {
        passwordField.type = 'password';
        toggleButton.textContent = 'üëÅÔ∏è';
      }
    });

    // Password Validation Function
    function validatePassword(password) {
      const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
      return regex.test(password);
    }

    // Password Strength Indicator with Real-time Criteria Check
    document.getElementById('password').addEventListener('input', function () {
      const password = this.value;
      const strengthMessage = document.getElementById('passwordStrength');
      
      // Check each criteria
      const hasLength = password.length >= 8;
      const hasLowercase = /[a-z]/.test(password);
      const hasUppercase = /[A-Z]/.test(password);
      const hasNumber = /\d/.test(password);
      const hasSpecial = /[@$!%*?&]/.test(password);
      
      // Update visual indicators
      document.getElementById('lengthCheck').textContent = (hasLength ? '‚úÖ' : '‚ùå') + ' At least 8 characters';
      document.getElementById('lowercaseCheck').textContent = (hasLowercase ? '‚úÖ' : '‚ùå') + ' At least one lowercase letter (a-z)';
      document.getElementById('uppercaseCheck').textContent = (hasUppercase ? '‚úÖ' : '‚ùå') + ' At least one uppercase letter (A-Z)';
      document.getElementById('numberCheck').textContent = (hasNumber ? '‚úÖ' : '‚ùå') + ' At least one number (0-9)';
      document.getElementById('specialCheck').textContent = (hasSpecial ? '‚úÖ' : '‚ùå') + ' At least one special character (@$!%*?&)';
      
      // Overall strength message
      if (password.length === 0) {
        strengthMessage.textContent = '';
        strengthMessage.style.color = '';
      } else if (validatePassword(password)) {
        strengthMessage.textContent = '‚úÖ Password meets all requirements!';
        strengthMessage.style.color = 'green';
      } else {
        const missing = [];
        if (!hasLength) missing.push('length');
        if (!hasLowercase) missing.push('lowercase');
        if (!hasUppercase) missing.push('uppercase');
        if (!hasNumber) missing.push('number');
        if (!hasSpecial) missing.push('special character');
        
        strengthMessage.textContent = `‚ùå Missing: ${missing.join(', ')}`;
        strengthMessage.style.color = 'red';
      }
    });

    // Registration Form Submission
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      // Clear previous errors
      document.getElementById('error').textContent = '';

      // Validate password before sending to server
      if (!validatePassword(password)) {
        document.getElementById('error').textContent = '‚ùå Password does not meet all requirements. Please check the criteria above.';
        return;
      }

      try {
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password }),
        });

        const data = await response.json();
        if (response.ok) {
          alert('‚úÖ Registration successful! Redirecting to login...');
          window.location.href = 'login.html';
        } else {
          document.getElementById('error').textContent = '‚ùå ' + data.message;
        }
      } catch (error) {
        console.error('Registration error:', error);
        document.getElementById('error').textContent = '‚ùå Server error. Please try again.';
      }
    });
  </script>

</body>
</html>
